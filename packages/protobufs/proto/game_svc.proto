syntax = "proto3";

import "google/protobuf/empty.proto";

enum GameOutcome {
  WHITE_WINS = 0;
  BLACK_WINS = 1;
  TIE = 2;
  KEEP_PLAYING = 3;
}

message GameSettingsMsg {
  optional uint32 time = 1;
  optional uint32 increment = 2;
}

message GameStateMsg {
  string fen = 1;
  repeated string moveSans = 2;
  GameOutcome outcome = 3;
  optional uint32 timeLeftWhite = 4;
  optional uint32 timeLeftBlack = 5;
  optional string drawAskedBy = 6;
}

message CreateGameRequest {
  string whitePlayerId = 1;
  string blackPlayerId = 2;
  GameSettingsMsg settings = 3;
  optional string whitePlayerUsername = 4;
  optional string blackPlayerUsername = 5;
}

message GameIdMsg {
  string gameId = 1;
}

message GetGameInfoResponse {
  string whitePlayerId = 1;
  string blackPlayerId = 2;
  GameSettingsMsg settings = 3;
  GameStateMsg state = 4;
  optional string whitePlayerUsername = 5;
  optional string blackPlayerUsername = 6;  
}

message MakeMoveRequest {
  string gameId = 1;
  string playerId = 2;
  string san = 3;
}

message MakeMoveResponse {
  string updatedFen = 1;
  GameOutcome updatedOutcome = 2;
  optional uint32 updatedTimeLeft = 3;
}

message AskOrAcceptDrawRequest {
  string gameId = 1;
  string playerId = 2;
}

service GameService {
  rpc CreateGame(CreateGameRequest) returns (GameIdMsg) {}
  rpc MakeMove(MakeMoveRequest) returns (MakeMoveResponse) {}
  rpc GetGameInfo(GameIdMsg) returns (GetGameInfoResponse) {}
  // rpc GetGames(GetGamesMessage) returns (GameRecordsMessage) {}
  rpc AskDraw(AskOrAcceptDrawRequest) returns (google.protobuf.Empty) {}
  rpc AcceptDraw(AskOrAcceptDrawRequest) returns (google.protobuf.Empty) {}
}
